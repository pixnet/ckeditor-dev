(function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)})(function(e){function p(e,b,a){var d;return d=e.getWrapperElement().appendChild(document.createElement("div")),d.className=a?"CodeMirror-dialog CodeMirror-dialog-bottom":"CodeMirror-dialog CodeMirror-dialog-top","string"==typeof b?d.innerHTML=b:d.appendChild(b),d}function r(e,b){e.state.currentNotificationClose&&e.state.currentNotificationClose();
e.state.currentNotificationClose=b}e.defineExtension("openDialog",function(f,b,a){function d(d){if("string"==typeof d)c.value=d;else if(!h&&(h=!0,m.parentNode.removeChild(m),l.focus(),a.onClose))a.onClose(m)}var c;a||(a={});r(this,null);var m=p(this,f,a.bottom),h=!1,l=this;if(c=m.getElementsByTagName("input")[0],c){if(a.value&&(c.value=a.value,!1!==a.selectValueOnOpen&&c.select()),a.onInput)e.on(c,"input",function(b){a.onInput(b,c.value,d)});if(a.onKeyUp)e.on(c,"keyup",function(b){a.onKeyUp(b,c.value,
d)});e.on(c,"keydown",function(f){a&&a.onKeyDown&&a.onKeyDown(f,c.value,d)||((27==f.keyCode||!1!==a.closeOnEnter&&13==f.keyCode)&&(c.blur(),e.e_stop(f),d()),13==f.keyCode&&b(c.value,f))});if(!1!==a.closeOnBlur)e.on(c,"blur",d);c.focus()}else if(f=m.getElementsByTagName("button")[0]){e.on(f,"click",function(){d();l.focus()});if(!1!==a.closeOnBlur)e.on(f,"blur",d);f.focus()}return d});e.defineExtension("openConfirm",function(f,b,a){function d(){h||(h=!0,m.parentNode.removeChild(m),l.focus())}var c;
r(this,null);var m=p(this,f,a&&a.bottom);a=m.getElementsByTagName("button");var h=!1,l=this,n=1;a[0].focus();for(f=0;f<a.length;++f)c=a[f],function(a){e.on(c,"click",function(b){e.e_preventDefault(b);d();a&&a(l)})}(b[f]),e.on(c,"blur",function(){--n;setTimeout(function(){0>=n&&d()},200)}),e.on(c,"focus",function(){++n})});e.defineExtension("openNotification",function(f,b){function a(){c||(c=!0,clearTimeout(m),d.parentNode.removeChild(d))}r(this,a);var d=p(this,f,b&&b.bottom),c=!1,m,h=b&&"undefined"!=
typeof b.duration?b.duration:5E3;e.on(d,"click",function(b){e.e_preventDefault(b);a()});return h&&(m=setTimeout(a,h)),a})});
(function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror"),require("./searchcursor"),require("../dialog/dialog")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","./searchcursor","../dialog/dialog"],e):e(CodeMirror)})(function(e){function p(g,a){return"string"==typeof g?g=new RegExp(g.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$\x26"),a?"gi":"g"):g.global||(g=new RegExp(g.source,g.ignoreCase?"gi":"g")),{token:function(a){g.lastIndex=
a.pos;var b=g.exec(a.string);if(b&&b.index==a.pos)return a.pos+=b[0].length,"searching";b?a.pos=b.index:a.skipToEnd()}}}function r(){this.overlay=this.posFrom=this.posTo=this.lastQuery=this.query=null}function f(g){return g.state.search||(g.state.search=new r)}function b(g){return"string"==typeof g&&g==g.toLowerCase()}function a(g,a,d){return g.getSearchCursor(a,d,b(a))}function d(g,a,b,d,e){g.openDialog?g.openDialog(a,e,{value:d,selectValueOnOpen:!0}):e(prompt(b,d))}function c(g,a,b,d){g.openConfirm?
g.openConfirm(a,d):confirm(b)&&d[0]()}function m(a){var b=a.match(/^\/(.*)\/([a-z]*)$/);if(b)try{a=new RegExp(b[1],-1==b[2].indexOf("i")?"":"i")}catch(d){}return("string"==typeof a?""==a:a.test(""))&&(a=/x^/),a}function h(a,e){var c=f(a),k;if(c.query)return l(a,e);k=a.getSelection()||c.lastQuery;d(a,q,"Search for:",k,function(d){a.operation(function(){d&&!c.query&&(c.query=m(d),a.removeOverlay(c.overlay,b(c.query)),c.overlay=p(c.query,b(c.query)),a.addOverlay(c.overlay),a.showMatchesOnScrollbar&&
(c.annotate&&(c.annotate.clear(),c.annotate=null),c.annotate=a.showMatchesOnScrollbar(c.query,b(c.query))),c.posFrom=c.posTo=a.getCursor(),l(a,e))})})}function l(g,b){g.operation(function(){var d=f(g),c=a(g,d.query,b?d.posFrom:d.posTo);(c.find(b)||(c=a(g,d.query,b?e.Pos(g.lastLine()):e.Pos(g.firstLine(),0)),c.find(b)))&&(g.setSelection(c.from(),c.to()),g.scrollIntoView({from:c.from(),to:c.to()}),d.posFrom=c.from(),d.posTo=c.to())})}function n(a){a.operation(function(){var b=f(a);(b.lastQuery=b.query,
b.query)&&(b.query=null,a.removeOverlay(b.overlay),b.annotate&&(b.annotate.clear(),b.annotate=null))})}function u(b,e){if(!b.getOption("readOnly")){var q=b.getSelection()||f(b).lastQuery;d(b,v,"Replace:",q,function(f){f&&(f=m(f),d(b,t,"Replace with:","",function(d){if(e)b.operation(function(){for(var c,e=a(b,f);e.findNext();)"string"!=typeof f?(c=b.getRange(e.from(),e.to()).match(f),e.replace(d.replace(/\$(\d)/g,function(a,b){return c[b]}))):e.replace(d)});else{n(b);var q=a(b,f,b.getCursor()),h=function(){var d=
q.from(),e;!(e=q.findNext())&&(q=a(b,f),!(e=q.findNext())||d&&q.from().line==d.line&&q.from().ch==d.ch)||(b.setSelection(q.from(),q.to()),b.scrollIntoView({from:q.from(),to:q.to()}),c(b,k,"Replace?",[function(){t(e)},h]))},t=function(a){q.replace("string"==typeof f?d:d.replace(/\$(\d)/g,function(b,d){return a[d]}));h()};h()}}))})}}var q='Search: \x3cinput type\x3d"text" style\x3d"width: 10em" class\x3d"CodeMirror-search-field"/\x3e \x3cspan style\x3d"color: #888" class\x3d"CodeMirror-search-hint"\x3e(Use /re/ syntax for regexp search)\x3c/span\x3e',
v='Replace: \x3cinput type\x3d"text" style\x3d"width: 10em" class\x3d"CodeMirror-search-field"/\x3e \x3cspan style\x3d"color: #888" class\x3d"CodeMirror-search-hint"\x3e(Use /re/ syntax for regexp search)\x3c/span\x3e',t='With: \x3cinput type\x3d"text" style\x3d"width: 10em" class\x3d"CodeMirror-search-field"/\x3e',k="Replace? \x3cbutton\x3eYes\x3c/button\x3e \x3cbutton\x3eNo\x3c/button\x3e \x3cbutton\x3eStop\x3c/button\x3e";e.commands.find=function(a){n(a);h(a)};e.commands.findNext=h;e.commands.findPrev=
function(a){h(a,!0)};e.commands.clearSearch=n;e.commands.replace=u;e.commands.replaceAll=function(a){u(a,!0)}});
(function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)})(function(e){function p(b,a,d,c){var e,h,l,n;this.atOccurrence=!1;this.doc=b;null==c&&"string"==typeof a&&(c=!1);d=d?b.clipPos(d):f(0,0);this.pos={from:d,to:d};"string"!=typeof a?(a.global||(a=new RegExp(a.source,a.ignoreCase?"ig":"g")),this.matches=function(d,c){var e,h,k,g,l;if(d){a.lastIndex=0;e=b.getLine(c.line).slice(0,
c.ch);for(h=0;(a.lastIndex=h,l=a.exec(e),l)&&(k=l,g=k.index,h=k.index+(k[0].length||1),h!=e.length););(h=k&&k[0].length||0)||(0==g&&0==e.length?k=void 0:g!=b.getLine(c.line).length&&h++)}else a.lastIndex=c.ch,e=b.getLine(c.line),h=(k=a.exec(e))&&k[0].length||0,g=k&&k.index,g+h==e.length||h||(h=1);if(k&&h)return{from:f(c.line,g),to:f(c.line,g+h),match:k}}):(e=a,c&&(a=a.toLowerCase()),h=c?function(a){return a.toLowerCase()}:function(a){return a},l=a.split("\n"),1==l.length?this.matches=a.length?function(d,
c){if(d){var l=b.getLine(c.line).slice(0,c.ch),n=h(l),k=n.lastIndexOf(a);if(-1<k)return k=r(l,n,k),{from:f(c.line,k),to:f(c.line,k+e.length)}}else if(l=b.getLine(c.line).slice(c.ch),n=h(l),k=n.indexOf(a),-1<k)return k=r(l,n,k)+c.ch,{from:f(c.line,k),to:f(c.line,k+e.length)}}:function(){}:(n=e.split("\n"),this.matches=function(a,c){var d=l.length-1,e,k,g,m,p;if(a){if(c.line-(l.length-1)<b.firstLine()||h(b.getLine(c.line).slice(0,n[d].length))!=l[l.length-1])return;e=f(c.line,n[d].length);m=c.line-
1;for(p=d-1;1<=p;--p,--m)if(l[p]!=h(b.getLine(m)))return;return(k=b.getLine(m),g=k.length-n[0].length,h(k.slice(g))!=l[0])?void 0:{from:f(m,g),to:e}}if(!(c.line+(l.length-1)>b.lastLine())&&(k=b.getLine(c.line),g=k.length-n[0].length,h(k.slice(g))==l[0])){e=f(c.line,g);m=c.line+1;for(p=1;p<d;++p,++m)if(l[p]!=h(b.getLine(m)))return;if(h(b.getLine(m).slice(0,n[d].length))==l[d])return{from:e,to:f(m,n[d].length)}}}))}function r(b,a,d){var c;if(b.length==a.length)return d;for(a=Math.min(d,b.length);;)if(c=
b.slice(0,a).toLowerCase().length,c<d)++a;else if(c>d)--a;else return a}var f=e.Pos;p.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(b){function a(a){a=f(a,0);return d.pos={from:a,to:a},d.atOccurrence=!1,!1}for(var d=this,c=this.doc.clipPos(b?this.pos.from:this.pos.to),e;;){if(this.pos=this.matches(b,c))return this.atOccurrence=!0,this.pos.match||!0;if(b){if(!c.line)return a(0);c=f(c.line-1,this.doc.getLine(c.line-1).length)}else{if(e=
this.doc.lineCount(),c.line==e-1)return a(e);c=f(c.line+1,0)}}},from:function(){if(this.atOccurrence)return this.pos.from},to:function(){if(this.atOccurrence)return this.pos.to},replace:function(b,a){if(this.atOccurrence){var d=e.splitLines(b);this.doc.replaceRange(d,this.pos.from,this.pos.to,a);this.pos.to=f(this.pos.from.line+d.length-1,d[d.length-1].length+(1==d.length?this.pos.from.ch:0))}}};e.defineExtension("getSearchCursor",function(b,a,d){return new p(this.doc,b,a,d)});e.defineDocExtension("getSearchCursor",
function(b,a,d){return new p(this,b,a,d)});e.defineExtension("selectMatches",function(b,a){for(var d=[],c=this.getSearchCursor(b,this.getCursor("from"),a);c.findNext()&&!(0<e.cmpPos(c.to(),this.getCursor("to")));)d.push({anchor:c.from(),head:c.to()});d.length&&this.setSelections(d,0)})});